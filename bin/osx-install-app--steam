#!/bin/sh -ev

echo "Installing: Steam"

if [ ! -d ~/Library/Caches/central_plexus ]; then
  mkdir -p ~/Library/Caches/central_plexus
fi

cd ~/Library/Caches/central_plexus
if [ ! -f steam.dmg.ok ]; then
  curl http://cdn.store.steampowered.com/public/client/installer/steam.dmg -o steam.dmg
  hdiutil verify steam.dmg
  touch steam.dmg.ok
fi
if [ ! -d ~/Applications/ ]; then
  mkdir -p ~/Applications/
fi
hdiutil convert -ov -format UDRW -o steam.rw.dmg steam.dmg
hdiutil attach -noautoopen -noidme steam.rw.dmg
sleep 1
rsync -a /Volumes/steam/Steam.app/ ~/Applications/Steam.app/
sleep 1
hdiutil unmount -force /Volumes/steam
sleep 1
rm -f steam.rw.dmg
