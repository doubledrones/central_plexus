#!/bin/sh -ev

if [ ! -d ~/Library/Caches/central_plexus ]; then
  mkdir -p ~/Library/Caches/central_plexus
fi

cd ~/Library/Caches/central_plexus
if [ ! -f MacPorts-1.9.2.tar.bz2.ok ]; then
  curl http://distfiles.macports.org/MacPorts/MacPorts-1.9.2.tar.bz2 -o MacPorts-1.9.2.tar.bz2
  cd /tmp
  tar xvjf ~/Library/Caches/central_plexus/MacPorts-1.9.2.tar.bz2 -C /tmp/
  touch MacPorts-1.9.2.tar.bz2.ok
else
  tar xvjf ~/Library/Caches/central_plexus/MacPorts-1.9.2.tar.bz2 -C /tmp/
fi

cd /tmp/MacPorts-1.9.2

./configure \
  --with-no-root-privileges \
  --prefix=$HOME/.macports \
  --enable-readline \
  --with-install-user=`id -un` \
  --with-install-group=`id -gn` \
  --with-tclpackage=$HOME/.macports/share/macports/Tcl

make
make install

echo "-doc +no_x11 +no_java -ipv6" > $HOME/.macports/etc/macports/variants.conf

echo "buildmakejobs `osx-makejobs`" > $HOME/.macports/macports.conf

cd

export PATH="~/.macports/bin:$PATH"

port -v selfupdate

rm -rf /tmp/MacPorts-1.9.2
